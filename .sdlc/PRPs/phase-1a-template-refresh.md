# PRP: Phase 1A - Template Refresh

## Goal
Audit, update, and create templates that will form the foundation of Bootstrap's refactored 4D+1 command architecture. Templates must incorporate spec-kit's clarity and simplicity while maintaining Bootstrap's comprehensive safety and structure. Key focus: **command-driven execution** with **embedded intelligence**, not passive rule loading.

## Why
- Current templates are rule-focused, need to become command-focused
- Spec-kit demonstrates superior clarity in template design
- Templates must support the new 4D+1 workflow (Init → Determine → Design → Define → Do)
- Version footers needed for artifact tracking
- Token efficiency critical: templates must be concise yet complete
- Progressive disclosure: simple for beginners, powerful for experts

## What
Create and refresh templates to enable command-driven workflow with embedded intelligence.

### Success Criteria
- [ ] All existing templates audited and documented
- [ ] New templates created for charter, requirements, DIP
- [ ] Version footers added to all templates
- [ ] Spec-kit clarity principles incorporated
- [ ] Template naming convention standardized

## All Needed Context

### Documentation & References
```yaml
- file: .sdlc/designs/026-refactor-command-architecture/design.md
  why: Phase 1A specifications from lines 299-319

- file: .claude/templates/
  why: Current templates directory to audit

- dir: temp/spec-kit-main/templates/
  why: Spec-kit templates for inspiration and patterns

- file: temp/spec-kit-main/memory/constitution.md
  why: Charter template pattern from spec-kit

- file: temp/spec-kit-main/templates/spec-template.md
  why: Requirements gathering pattern

- file: temp/spec-kit-main/templates/plan-template.md
  why: Design planning pattern

- file: .claude/templates/prp-base.template.md
  why: Existing PRP template for DIP creation pattern

- file: .claude/templates/feature-enhanced.template.md
  why: Existing requirements template to merge with spec-kit

- file: .claude/templates/adr.template.md
  why: ADR template already exists, just needs footer
```

### Current Codebase tree
```bash
.claude/templates/
├── adr.template.md
├── branch-name.template
├── changelog-entry.template
├── command.template.md
├── commit-message.template
├── config-default.template.yaml
├── config-section.template.yaml
├── feature-design.template.md
├── feature-enhanced.template.md
├── feature-quick.template.md
├── planning.template.md
├── prp-base.template.md
├── README.md
├── README.template.md
├── rule-doc.template.md
├── rule.template.md
├── task-commit.template.md
├── task-discovered.template.md
└── task.template.md
```

### Desired Codebase tree with files to be added
```bash
.claude/templates/
├── [EXISTING FILES - TO BE UPDATED WITH FOOTERS]
├── charter.template.md           # NEW - Base charter template
├── charter-prototype.template.md # NEW - Minimal charter for prototypes
├── charter-draft.template.md     # NEW - Full charter, changeable
├── charter-ratified.template.md  # NEW - Formal charter, amendment process
├── requirements.template.md      # NEW - Merge of Bootstrap + spec-kit
├── dip.template.md               # NEW - Design Implementation Prompt
├── dip-phase.template.md         # NEW - For multi-phase DIPs
├── amendment.template.md         # NEW - Charter amendment template
└── design-phase.template.md      # NEW - For phased designs
```

### Known Gotchas of our codebase & Library Quirks
```python
# CRITICAL: Templates use placeholder syntax [PLACEHOLDER_NAME]
# CRITICAL: Some templates have YAML frontmatter (preserve this)
# CRITICAL: Templates in Bootstrap use .template.md extension
# CRITICAL: Spec-kit uses different placeholder style - standardize to [BRACKETS]
# CRITICAL: Version footers must be at END of template, not beginning
# CRITICAL: Balance simplicity with safety - don't oversimplify
# CRITICAL: Templates will be selected by AI agents, not hardcoded logic
```

## Implementation Blueprint

### Data models and structure
Templates follow this structure:
```yaml
# Optional YAML frontmatter for metadata
---
name: "Template Name"
description: "Purpose and usage"
---

# Main Content
[PLACEHOLDER_SECTIONS]

---
*Generated by Bootstrap [COMMAND_NAME] v[VERSION] on [DATE]*
```

### List of tasks to be completed in order

```yaml
Task 1: Audit existing templates
EXAMINE .claude/templates/:
  - Document each template's purpose
  - Identify which commands use each template
  - Note which need version footers
  - Flag obsolete templates for removal

Task 2: Create base charter template
CREATE .claude/templates/charter.template.md:
  - Base template with all possible sections
  - Use [PROJECT_NAME], [PRINCIPLE_N_NAME] placeholders
  - Include governance section
  - Add version footer

Task 3: Create charter-prototype variant
CREATE .claude/templates/charter-prototype.template.md:
  - Minimal sections only
  - Allow empty/TODO sections
  - Quick start focus

Task 4: Create charter-draft variant
CREATE .claude/templates/charter-draft.template.md:
  - All sections required
  - Changeable without process
  - Development mode

Task 5: Create charter-ratified variant
CREATE .claude/templates/charter-ratified.template.md:
  - Formal structure
  - Amendment process required
  - Version tracking

Task 6: Create requirements template
CREATE .claude/templates/requirements.template.md:
  - MERGE patterns from:
    - .claude/templates/feature-enhanced.template.md (Bootstrap structure)
    - temp/spec-kit-main/templates/spec-template.md (clarity and gates)
  - Include [NEEDS CLARIFICATION] markers
  - Add testability checklist
  - Version footer

Task 7: Create DIP template (single-phase)
CREATE .claude/templates/dip.template.md:
  - Transform from prp-base.template.md
  - Focus on single-phase implementation
  - Include validation gates
  - Embed test requirements
  - Add git commit specs

Task 8: Create DIP template (multi-phase)
CREATE .claude/templates/dip-phase.template.md:
  - For multi-phase implementations
  - Phase dependencies
  - Checkpoint validation

Task 9: Create amendment template
CREATE .claude/templates/amendment.template.md:
  - Charter change process
  - Impact analysis section
  - Migration requirements

Task 10: Create design-phase template
CREATE .claude/templates/design-phase.template.md:
  - For designs >5 days effort
  - Phase breakdown structure
  - Dependencies tracking

Task 11: Update existing templates with version footers
MODIFY each existing .template.md file:
  - FIND: End of file
  - INJECT: Version footer pattern
  - PRESERVE: All existing content
  - Pattern: "---\n*Generated by Bootstrap [COMMAND] v[VERSION] on [DATE]*"

Task 12: Standardize placeholder syntax
UPDATE all templates:
  - FIND: Various placeholder styles (${VAR}, {{VAR}}, <VAR>)
  - REPLACE: With [VAR] bracket style
  - MAINTAIN: Consistency across all templates

Task 13: Create template index
UPDATE .claude/templates/README.md:
  - List all templates
  - Document which command uses each
  - Include usage examples
  - Add quick reference guide
```

### Integration Points
```yaml
NEW COMMANDS (Phase 1B):
  - /init: Will select charter-*.template.md based on project mode
  - /determine: Will use requirements.template.md
  - /design: Will use existing design.template.md + new design-phase.template.md
  - /define: Will use dip.template.md, dip-phase.template.md
  - These are for FUTURE commands, not current ones

CURRENT USAGE:
  - Only needed once more: Generate PRP for Phase 1B command implementation
  - After Phase 1B, we switch to new command system entirely
  - Current commands DO NOT use these templates

TEMPLATE SELECTION:
  - AI agents will select appropriate template variant
  - No hardcoded selection logic needed
  - Consider creating selection rule in Phase 2 instead of docs

MINIMAL UPDATES:
  - Update .claude/templates/README.md with template index only
  - Skip command documentation updates (commands changing anyway)
  - Full documentation overhaul deferred to future phase
```

## Validation Loop

### Level 1: Syntax & Style
```bash
# Check all templates are valid markdown
for file in .claude/templates/*.template.md; do
  echo "Checking $file"
  # Verify markdown structure
  grep -q "^#" "$file" || echo "Missing headers in $file"
  # Check for placeholder pattern
  grep -q "\[.*\]" "$file" || echo "No placeholders in $file"
done

# Expected: All templates have headers and placeholders
```

### Level 2: Template Completeness
```bash
# Verify required templates exist
required=(
  "charter.template.md"
  "requirements.template.md"
  "dip.template.md"
  "amendment.template.md"
)

for template in "${required[@]}"; do
  if [ -f ".claude/templates/$template" ]; then
    echo "✓ $template exists"
  else
    echo "✗ $template missing"
  fi
done

# Verify version footers
for file in .claude/templates/*.template.md; do
  if grep -q "Generated by Bootstrap" "$file"; then
    echo "✓ $(basename $file) has version footer"
  else
    echo "✗ $(basename $file) missing version footer"
  fi
done
```

### Level 3: Integration Test
```bash
# Test template usage in a command simulation
# Create test charter from template
cp .claude/templates/charter-prototype.template.md test-charter.md
sed -i 's/\[PROJECT_NAME\]/TestProject/g' test-charter.md
sed -i 's/\[PRINCIPLE_1_NAME\]/Test Principle/g' test-charter.md

# Verify substitution worked
grep -q "TestProject" test-charter.md && echo "✓ Template substitution works"

# Clean up
rm -f test-charter.md
```

## Final validation Checklist
- [ ] All existing templates audited
- [ ] Charter template variants created (prototype, draft, ratified)
- [ ] Requirements template merges Bootstrap + spec-kit patterns
- [ ] DIP templates created for single and multi-phase
- [ ] Amendment and phase templates created
- [ ] Version footers added to ALL templates
- [ ] Placeholder syntax standardized to [BRACKETS]
- [ ] Template README updated with index
- [ ] Each template references correct command
- [ ] Templates follow consistent structure

---

## Anti-Patterns to Avoid
- ❌ Don't create templates without clear command usage
- ❌ Don't mix placeholder styles within a template
- ❌ Don't forget version footers - critical for tracking
- ❌ Don't make templates too rigid - allow flexibility
- ❌ Don't lose Bootstrap's safety in pursuit of simplicity
- ❌ Don't create duplicate templates with minor variations

## PRP Confidence Score: 9/10
High confidence due to:
- Clear specifications in design document
- Existing templates to build upon
- Spec-kit examples for reference
- Well-defined validation criteria

Minor uncertainty on exact merger patterns between Bootstrap and spec-kit styles.